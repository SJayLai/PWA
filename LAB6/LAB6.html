<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="LAB2.css">
		<link rel="manifest" href="manifest.json">          
		<script src="smoothie.js" type="text/javascript"></script>

	</head>
	<body>
        ECG波形
		<div style="float: left;">
			<canvas id="myCanvas1" width="1250" height="256">
				Your browser does not support the HTML canvas tag.
			</canvas>
		</div>

		<div style="float: top; position:absolute;">
			<canvas id="myCanvas2" width="1250" height="256">
				Your browser does not support the HTML canvas tag.
			</canvas>
        </div>
        
        <div style="float: top; position:absolute;">
			<canvas id="myCanvas3" width="1250" height="256">
				Your browser does not support the HTML canvas tag.
			</canvas>
		</div>
	</body>
</html>



<script>


	// Parameters Initialization
	var equDataRate = 300;   // Hz
	var frameLength = 8; // Sec
	var drawPointsUnit = 40; //points
	var data = Array(equDataRate*frameLength);
	var drawPointsIndex = 0;

    var test_data =    [131,130,129,130,131,130,131,132,131,131,131,131,131,132,131,131,133,130,132,132,131,130,130,132,131,130
,131,132,132,131,132,131,129,130,130,132,131,130,129,130,130,130,128,130,130,129,129,130,129,128,128,128
,128,128,128,127,129,127,128,126,127,127,128,128,130,129,131,129,128,129,129,129,131,131,131,130,133,132
,134,135,135,136,134,135,135,132,132,132,133,130,131,128,128,127,124,127,124,124,124,124,123,123,124,124
,123,123,123,123,123,122,125,122,124,123,123,124,122,122,124,122,122,124,122,122,126,128,134,142,150,163,
174,190,202,211,216,206,190,162,136,106,83,69,60,56,57,58,62,65,71,73,75,86,93,100,108,111,114,117,119,119,
121,123,123,126,126,127,126,128,128,129,130,130,130,131,131,132,132,133,132,133,134,134,134,134,134,135,136,
135,137,136,137,136,135,137,137,138,138,137,137,139,139,138,139,140,138,140,141,139,140,142,142,142,142,141,
143,142,143,144,143,143,146,146,145,147,146,147,147,148,148,148,147,149,148,149,148,150,148,150,150,149,150,
148,150,149,149,148,146,148,147,144,146,145,143,143,141,139,139,138,136,137,135,136,133,134,132,130,130,128,
130,130,127,129,128,128,126,127,127,126,127,126,126,125,127,124,126,126,124,124,125,124,125,125,125,125,124,
125,125,124,125,125,126,125,126,125,125,125,126,125,126,125,126,128,125,127,125,125,129,125,127,126,128,127,
127,127,126,128,127,126,127,126,126,127,127,126,126,126,126,125,126,126,126,126,126,124,124,124,125,124,124,
123,124,124,125,125,124,126,126,125,125,126,125,125,127,129,129,130,130,131,132,132,134,132,132,132,131,130,
131,128,128,128,127,125,124,124,124,122,120,120,121,120,120,120,119,120,119,121,121,118,119,119,119,120,119,
119,117,121,118,119,118,119,119,120,117,118,122,126,130,140,146,160,173,186,197,208,212,199,178,151,124,97,
74,61,54,52,52,53,60,62,66,68,76,85,90,98,104,108,111,114,114,118
,118,118,118,121,121,123,124,124,124,124,126,126,127,126,129,128,127,129,129,130,129,129,130,130,131,131
,132,131,132,133,132,132,133,135,133,135,133,136,135,136,136,136,136,138,136,137,137,139,139,139,138,139
,139,140,140,140,142,142,141,143,143,142,143,143,146,146,146,145,144,146,145,147,146,148,148,146,148,148
,148,149,148,148,147,147,148,147,144,146,145,141,141,141,141,139,137,137,137,135,135,133,132,131,130,132
,129,128,128,128,126,126,126,124,124,125,125,124,123,124,125,125,125,124,125,126,127,126,125,126,125,124
,126,125,126,126,127,127,127,128,129,129,128,131,130,132,130,130,130,130,129,128,

131,130,129,130,131,130,131,132,131,131,131,131,131,132,131,131,133,130,132,132,131,130,130,132,131,130
,131,132,132,131,132,131,129,130,130,132,131,130,129,130,130,130,128,130,130,129,129,130,129,128,128,128
,128,128,128,127,129,127,128,126,127,127,128,128,130,129,131,129,128,129,129,129,131,131,131,130,133,132
,134,135,135,136,134,135,135,132,132,132,133,130,131,128,128,127,124,127,124,124,124,124,123,123,124,124
,123,123,123,123,123,122,125,122,124,123,123,124,122,122,124,122,122,124,122,122,126,128,134,142,150,163,
174,190,202,211,216,206,190,162,136,106,83,69,60,56,57,58,62,65,71,73,75,86,93,100,108,111,114,117,119,119,
121,123,123,126,126,127,126,128,128,129,130,130,130,131,131,132,132,133,132,133,134,134,134,134,134,135,136,
135,137,136,137,136,135,137,137,138,138,137,137,139,139,138,139,140,138,140,141,139,140,142,142,142,142,141,
143,142,143,144,143,143,146,146,145,147,146,147,147,148,148,148,147,149,148,149,148,150,148,150,150,149,150,
148,150,149,149,148,146,148,147,144,146,145,143,143,141,139,139,138,136,137,135,136,133,134,132,130,130,128,
130,130,127,129,128,128,126,127,127,126,127,126,126,125,127,124,126,126,124,124,125,124,125,125,125,125,124,
125,125,124,125,125,126,125,126,125,125,125,126,125,126,125,126,128,125,127,125,125,129,125,127,126,128,127,
127,127,126,128,127,126,127,126,126,127,127,126,126,126,126,125,126,126,126,126,126,124,124,124,125,124,124,
123,124,124,125,125,124,126,126,125,125,126,125,125,127,129,129,130,130,131,132,132,134,132,132,132,131,130,
131,128,128,128,127,125,124,124,124,122,120,120,121,120,120,120,119,120,119,121,121,118,119,119,119,120,119,
119,117,121,118,119,118,119,119,120,117,118,122,126,130,140,146,160,173,186,197,208,212,199,178,151,124,97,
74,61,54,52,52,53,60,62,66,68,76,85,90,98,104,108,111,114,114,118
,118,118,118,121,121,123,124,124,124,124,126,126,127,126,129,128,127,129,129,130,129,129,130,130,131,131
,132,131,132,133,132,132,133,135,133,135,133,136,135,136,136,136,136,138,136,137,137,139,139,139,138,139
,139,140,140,140,142,142,141,143,143,142,143,143,146,146,146,145,144,146,145,147,146,148,148,146,148,148
,148,149,148,148,147,147,148,147,144,146,145,141,141,141,141,139,137,137,137,135,135,133,132,131,130,132
,129,128,128,128,126,126,126,124,124,125,125,124,123,124,125,125,125,124,125,126,127,126,125,126,125,124
,126,125,126,126,127,127,127,128,129,129,128,131,130,132,130,130,130,130,129,128,

131,130,129,130,131,130,131,132,131,131,131,131,131,132,131,131,133,130,132,132,131,130,130,132,131,130
,131,132,132,131,132,131,129,130,130,132,131,130,129,130,130,130,128,130,130,129,129,130,129,128,128,128
,128,128,128,127,129,127,128,126,127,127,128,128,130,129,131,129,128,129,129,129,131,131,131,130,133,132
,134,135,135,136,134,135,135,132,132,132,133,130,131,128,128,127,124,127,124,124,124,124,123,123,124,124
,123,123,123,123,123,122,125,122,124,123,123,124,122,122,124,122,122,124,122,122,126,128,134,142,150,163,
174,190,202,211,216,206,190,162,136,106,83,69,60,56,57,58,62,65,71,73,75,86,93,100,108,111,114,117,119,119,
121,123,123,126,126,127,126,128,128,129,130,130,130,131,131,132,132,133,132,133,134,134,134,134,134,135,136,
135,137,136,137,136,135,137,137,138,138,137,137,139,139,138,139,140,138,140,141,139,140,142,142,142,142,141,
143,142,143,144,143,143,146,146,145,147,146,147,147,148,148,148,147,149,148,149,148,150,148,150,150,149,150,
148,150,149,149,148,146,148,147,144,146,145,143,143,141,139,139,138,136,137,135,136,133,134,132,130,130,128,
130,130,127,129,128,128,126,127,127,126,127,126,126,125,127,124,126,126,124,124,125,124,125,125,125,125,124,
125,125,124,125,125,126,125,126,125,125,125,126,125,126,125,126,128,125,127,125,125,129,125,127,126,128,127,
127,127,126,128,127,126,127,126,126,127,127,126,126,126,126,125,126,126,126,126,126,124,124,124,125,124,124,
123,124,124,125,125,124,126,126,125,125,126,125,125,127,129,129,130,130,131,132,132,134,132,132,132,131,130,
131,128,128,128,127,125,124,124,124,122,120,120,121,120,120,120,119,120,119,121,121,118,119,119,119,120,119,
119,117,121,118,119,118,119,119,120,117,118,122,126,130,140,146,160,173,186,197,208,212,199,178,151,124,97,
74,61,54,52,52,53,60,62,66,68,76,85,90,98,104,108,111,114,114,118
,118,118,118,121,121,123,124,124,124,124,126,126,127,126,129,128,127,129,129,130,129,129,130,130,131,131
,132,131,132,133,132,132,133,135,133,135,133,136,135,136,136,136,136,138,136,137,137,139,139,139,138,139
,139,140,140,140,142,142,141,143,143,142,143,143,146,146,146,145,144,146,145,147,146,148,148,146,148,148
,148,149,148,148,147,147,148,147,144,146,145,141,141,141,141,139,137,137,137,135,135,133,132,131,130,132
,129,128,128,128,126,126,126,124,124,125,125,124,123,124,125,125,125,124,125,126,127,126,125,126,125,124
,126,125,126,126,127,127,127,128,129,129,128,131,130,132,130,130,130,130,129,128,

131,130,129,130,131,130,131,132,131,131,131,131,131,132,131,131,133,130,132,132,131,130,130,132,131,130
,131,132,132,131,132,131,129,130,130,132,131,130,129,130,130,130,128,130,130,129,129,130,129,128,128,128
,128,128,128,127,129,127,128,126,127,127,128,128,130,129,131,129,128,129,129,129,131,131,131,130,133,132
,134,135,135,136,134,135,135,132,132,132,133,130,131,128,128,127,124,127,124,124,124,124,123,123,124,124
,123,123,123,123,123,122,125,122,124,123,123,124,122,122,124,122,122,124,122,122,126,128,134,142,150,163,
174,190,202,211,216,206,190,162,136,106,83,69,60,56,57,58,62,65,71,73,75,86,93,100,108,111,114,117,119,119,
121,123,123,126,126,127,126,128,128,129,130,130,130,131,131,132,132,133,132,133,134,134,134,134,134,135,136,
135,137,136,137,136,135,137,137,138,138,137,137,139,139,138,139,140,138,140,141,139,140,142,142,142,142,141,
143,142,143,144,143,143,146,146,145,147,146,147,147,148,148,148,147,149,148,149,148,150,148,150,150,149,150,
148,150,149,149,148,146,148,147,144,146,145,143,143,141,139,139,138,136,137,135,136,133,134,132,130,130,128,
130,130,127,129,128,128,126,127,127,126,127,126,126,125,127,124,126,126,124,124,125,124,125,125,125,125,124,
125,125,124,125,125,126,125,126,125,125,125,126,125,126,125,126,128,125,127,125,125,129,125,127,126,128,127,
127,127,126,128,127,126,127,126,126,127,127,126,126,126,126,125,126,126,126,126,126,124,124,124,125,124,124,
123,124,124,125,125,124,126,126,125,125,126,125,125,127,129,129,130,130,131,132,132,134,132,132,132,131,130,
131,128,128,128,127,125,124,124,124,122,120,120,121,120,120,120,119,120,119,121,121,118,119,119,119,120,119,
119,117,121,118,119,118,119,119,120,117,118,122,126,130,140,146,160,173,186,197,208,212,199,178,151,124,97,
74,61,54,52,52,53,60,62,66,68,76,85,90,98,104,108,111,114,114,118
,118,118,118,121,121,123,124,124,124,124,126,126,127,126,129,128,127,129,129,130,129,129,130,130,131,131
,132,131,132,133,132,132,133,135,133,135,133,136,135,136,136,136,136,138,136,137,137,139,139,139,138,139
,139,140,140,140,142,142,141,143,143,142,143,143,146,146,146,145,144,146,145,147,146,148,148,146,148,148
,148,149,148,148,147,147,148,147,144,146,145,141,141,141,141,139,137,137,137,135,135,133,132,131,130,132
,129,128,128,128,126,126,126,124,124,125,125,124,123,124,125,125,125,124,125,126,127,126,125,126,125,124
,126,125,126,126,127,127,127,128,129,129,128,131,130,132,130,130,130,130,129,128
];

    console.log('Heart Rate :',(test_data.indexOf(52)-test_data.indexOf(56))/300*60,' BPM');
	// Get Canvas Object
	var c1 = document.getElementById("myCanvas1");
	var ctx1 = c1.getContext("2d");
	var c2 = document.getElementById("myCanvas2");
	var ctx2 = c2.getContext("2d");
	var c3 = document.getElementById("myCanvas3");
	var ctx3 = c3.getContext("2d");
	ctx2.imageSmoothingEnabled = ctx2.mozImageSmoothingEnabled = ctx2.webkitImageSmoothingEnabled = false
	ctx2.strokeStyle = "#09203f";
	ctx2.lineWidth = 1;
    
	drawBG();
    drawGrid();

    for (var j = 0; j < 2400; j++) {
        
        ecgchart();
    }
    
    
	function ecgchart(){
			
			// data[drawPointsIndex] = input_value;
			data[drawPointsIndex] = test_data[drawPointsIndex];
            var x_value = drawPointsIndex*(c2.width/(equDataRate*frameLength));

			ctx2.lineTo( x_value.toFixed(2) , data[drawPointsIndex]);
			
            //console.log( drawPointsIndex.toString()+" : "+x_value.toFixed(2).toString()+" , "+data[drawPointsIndex].toString() );
            
            if(drawPointsIndex%drawPointsUnit==drawPointsUnit-1) {
					ctx2.clearRect(0, 0, c2.width, c2.height);
					ctx2.stroke(); 
			}
			// console.log(data);
			drawPointsIndex++;

			// Turn around
			if(drawPointsIndex > data.length){
					drawPointsIndex = 0;
					ctx2.moveTo(0, 0);
					ctx2.clearRect(0, 0, c2.width, c2.height);
					ctx2.beginPath();
					drawBG();
					drawGrid();
				}
 
		}
	// Draw Canvas BG
	function drawBG() {
			// Create gradient
			var gradient = ctx1.createLinearGradient(0, 0, 0, 3*c1.height/2);
			gradient.addColorStop(0, "#80d0c7");
			gradient.addColorStop(1, "#13547a");

			// Fill with gradient
			ctx1.fillStyle = gradient;
			ctx1.fillRect(0, 0, c1.width, c1.height);
		}

	function drawGrid() {
			// Vertical Grid
			ctx1.strokeStyle = "#D7FFFE";
			ctx1.lineWidth = 1;
			var vlu = c1.width/(5*frameLength);  // 0.2 sec
			for(var vli = 0; vli <= 5*frameLength; vli++){
					ctx1.moveTo(vli*vlu.toFixed(2)-1.0, 0);
					ctx1.lineTo(vli*vlu.toFixed(2)-1.0, c1.height);
					ctx1.stroke();
				}
		}


</script>